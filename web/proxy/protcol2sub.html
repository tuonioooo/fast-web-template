<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ‚ç‚¹è½¬è®¢é˜…é“¾æ¥ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            border-radius: 2px;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }
        
        .node-list {
            background: #f9fafb;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .node-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .node-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .node-details {
            font-size: 12px;
            color: #666;
        }
        
        .output-box {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            max-height: 400px;
            overflow: auto;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat-item {
            flex: 1;
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”— èŠ‚ç‚¹è½¬è®¢é˜…é“¾æ¥ç”Ÿæˆå™¨</h1>
            <p>æ”¯æŒ VMessã€VLESSã€Trojanã€Shadowsocks ç­‰å¤šç§åè®®</p>
        </div>
        
        <div class="content">
            <div class="section">
                <div class="section-title">âœ… å·¥ä½œåŸç†</div>
                <div class="alert alert-info">
                    â€¢ è¾“å…¥ï¼šå•ä¸ªæˆ–å¤šä¸ªä»£ç†èŠ‚ç‚¹é“¾æ¥ï¼ˆvmess://ã€vless://ã€trojan://ã€ss://ç­‰ï¼‰<br>
                    â€¢ å¤„ç†ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶è§£æå„ç§åè®®èŠ‚ç‚¹<br>
                    â€¢ è¾“å‡ºï¼šç”Ÿæˆ Base64 ç¼–ç çš„è®¢é˜…é“¾æ¥ï¼Œå¯ç›´æ¥å¯¼å…¥å®¢æˆ·ç«¯ä½¿ç”¨
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">ğŸ“¥ å¯¼å…¥èŠ‚ç‚¹</div>
                <div class="alert alert-info">
                    æ”¯æŒæ ¼å¼ï¼š<br>
                    â€¢ VMess: vmess://eyJ2IjoiMiIsInBzIjoi...<br>
                    â€¢ VLESS: vless://uuid@host:port?type=...<br>
                    â€¢ Trojan: trojan://password@host:port?...<br>
                    â€¢ Shadowsocks: ss://method:password@host:port#...<br>
                    â€¢ æ¯è¡Œä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ”¯æŒæ··åˆç²˜è´´
                </div>
                <textarea id="nodeInput" rows="10" placeholder="è¯·ç²˜è´´èŠ‚ç‚¹é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ªï¼š&#10;&#10;vmess://eyJ2IjoiMiIsInBzIjoi...&#10;vless://uuid@host:port?type=ws...&#10;trojan://password@host:port?...&#10;ss://method:password@host:port#..."></textarea>
                
                <div class="btn-group">
                    <button class="btn-primary" onclick="parseNodes()">ğŸ” è§£æèŠ‚ç‚¹</button>
                    <button class="btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
            </div>
            
            <div id="nodeListSection" class="section hidden">
                <div class="section-title">ğŸ“‹ è§£æç»“æœ</div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalNodes">0</div>
                        <div class="stat-label">æ€»èŠ‚ç‚¹æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="vmessCount">0</div>
                        <div class="stat-label">VMess</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="vlessCount">0</div>
                        <div class="stat-label">VLESS</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="trojanCount">0</div>
                        <div class="stat-label">Trojan</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="ssCount">0</div>
                        <div class="stat-label">Shadowsocks</div>
                    </div>
                </div>
                <div id="nodeList" class="node-list"></div>
                <button class="btn-success" onclick="generateSubscription()">âœ¨ ç”Ÿæˆè®¢é˜…é“¾æ¥</button>
            </div>
            
            <div id="outputSection" class="section hidden">
                <div class="section-title">ğŸ‰ è®¢é˜…é“¾æ¥</div>
                <div class="alert alert-success">
                    è®¢é˜…é“¾æ¥ç”ŸæˆæˆåŠŸï¼å¤åˆ¶ä¸‹æ–¹é“¾æ¥å¯¼å…¥åˆ°å®¢æˆ·ç«¯ä½¿ç”¨
                </div>
                <div id="output" class="output-box"></div>
                <div class="btn-group">
                    <button class="btn-primary" onclick="copySubscription()">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
                    <button class="btn-success" onclick="downloadSubscription()">ğŸ’¾ ä¸‹è½½ä¸ºæ–‡ä»¶</button>
                </div>
                
                <div class="alert alert-warning" style="margin-top: 20px;">
                    ğŸ’¡ ä½¿ç”¨æç¤ºï¼š<br>
                    â€¢ å°†ç”Ÿæˆçš„è®¢é˜…é“¾æ¥å¤åˆ¶åˆ°æ”¯æŒè®¢é˜…çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ Clashã€V2Ray ç­‰ï¼‰<br>
                    â€¢ ä¹Ÿå¯ä»¥ä¸‹è½½ä¸º .txt æ–‡ä»¶ï¼Œå¯¼å…¥åˆ°å®¢æˆ·ç«¯ä½¿ç”¨<br>
                    â€¢ è®¢é˜…é“¾æ¥é‡‡ç”¨æ ‡å‡† Base64 ç¼–ç æ ¼å¼
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let parsedNodes = [];
        let nodeLinks = [];
        
        function parseNodes() {
            const input = document.getElementById('nodeInput').value.trim();
            
            if (!input) {
                alert('è¯·è¾“å…¥èŠ‚ç‚¹é“¾æ¥ï¼');
                return;
            }
            
            let lines = input.split('\n').filter(line => line.trim());
            
            // æ£€æµ‹æ˜¯å¦ä¸º Base64 ç¼–ç çš„è®¢é˜…ï¼ˆå¦‚æœä¸åŒ…å« :// ä¸”é•¿åº¦è¾ƒé•¿ï¼‰
            if (lines.length === 1 && !lines[0].includes('://') && lines[0].length > 50) {
                try {
                    const decoded = atob(lines[0]);
                    if (decoded.includes('://')) {
                        lines = decoded.split('\n').filter(line => line.trim());
                        console.log('æ£€æµ‹åˆ° Base64 è®¢é˜…ï¼Œå·²è‡ªåŠ¨è§£ç ');
                    }
                } catch (e) {
                    console.log('ä¸æ˜¯æœ‰æ•ˆçš„ Base64 ç¼–ç ');
                }
            }
            
            parsedNodes = [];
            nodeLinks = [];
            let stats = {
                vmess: 0,
                vless: 0,
                trojan: 0,
                ss: 0
            };
            
            lines.forEach((line, index) => {
                line = line.trim();
                if (!line) return;
                
                let nodeInfo = null;
                let originalLink = line;
                
                // å¤„ç†å¯èƒ½çš„åŒé‡ç¼–ç 
                if (line.startsWith('vmess://vmess://')) {
                    try {
                        const decoded = atob(line.replace('vmess://', ''));
                        if (decoded.startsWith('vmess://')) {
                            originalLink = decoded;
                            line = decoded;
                        }
                    } catch (e) {
                        console.log('åŒé‡ç¼–ç è§£æå¤±è´¥');
                    }
                }
                
                if (line.startsWith('vmess://')) {
                    nodeInfo = parseVmessInfo(line);
                    if (nodeInfo) {
                        stats.vmess++;
                        nodeLinks.push(originalLink);
                    }
                } else if (line.startsWith('vless://')) {
                    nodeInfo = parseVlessInfo(line);
                    if (nodeInfo) {
                        stats.vless++;
                        nodeLinks.push(originalLink);
                    }
                } else if (line.startsWith('trojan://')) {
                    nodeInfo = parseTrojanInfo(line);
                    if (nodeInfo) {
                        stats.trojan++;
                        nodeLinks.push(originalLink);
                    }
                } else if (line.startsWith('ss://')) {
                    nodeInfo = parseShadowsocksInfo(line);
                    if (nodeInfo) {
                        stats.ss++;
                        nodeLinks.push(originalLink);
                    }
                }
                
                if (nodeInfo) {
                    parsedNodes.push(nodeInfo);
                }
            });
            
            if (parsedNodes.length === 0) {
                alert('æ²¡æœ‰æˆåŠŸè§£æä»»ä½•èŠ‚ç‚¹ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ ¼å¼ï¼\n\næç¤ºï¼š\nâ€¢ ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹é“¾æ¥å®Œæ•´\nâ€¢ æ”¯æŒ vmess://, vless://, trojan://, ss:// åè®®\nâ€¢ å¯ä»¥ç›´æ¥ç²˜è´´è®¢é˜…é“¾æ¥ï¼ˆBase64 æ ¼å¼ï¼‰');
                return;
            }
            
            updateStats(stats);
            displayNodes();
        }
        
        function parseVmessInfo(link) {
            try {
                const base64 = link.replace('vmess://', '');
                const json = JSON.parse(atob(base64));
                
                return {
                    type: 'VMess',
                    name: json.ps || 'æœªå‘½åèŠ‚ç‚¹',
                    address: json.add,
                    port: json.port || 443,
                    network: json.net || 'tcp',
                    tls: json.tls || 'none'
                };
            } catch (e) {
                console.error('VMess è§£æé”™è¯¯:', e);
                return null;
            }
        }
        
        function parseVlessInfo(link) {
            try {
                let urlStr = link.replace('vless://', '');
                
                const atIndex = urlStr.indexOf('@');
                if (atIndex === -1) return null;
                
                const uuid = urlStr.substring(0, atIndex);
                const remaining = urlStr.substring(atIndex + 1);
                
                const questionIndex = remaining.indexOf('?');
                const hashIndex = remaining.indexOf('#');
                
                let addressPart, paramPart, namePart;
                
                if (questionIndex !== -1) {
                    addressPart = remaining.substring(0, questionIndex);
                    if (hashIndex !== -1) {
                        paramPart = remaining.substring(questionIndex + 1, hashIndex);
                        namePart = remaining.substring(hashIndex + 1);
                    } else {
                        paramPart = remaining.substring(questionIndex + 1);
                        namePart = '';
                    }
                } else if (hashIndex !== -1) {
                    addressPart = remaining.substring(0, hashIndex);
                    paramPart = '';
                    namePart = remaining.substring(hashIndex + 1);
                } else {
                    addressPart = remaining;
                    paramPart = '';
                    namePart = '';
                }
                
                const colonIndex = addressPart.lastIndexOf(':');
                const address = colonIndex !== -1 ? addressPart.substring(0, colonIndex) : addressPart;
                const port = colonIndex !== -1 ? addressPart.substring(colonIndex + 1) : '443';
                
                const params = new URLSearchParams(paramPart);
                const name = namePart ? decodeURIComponent(namePart) : 'æœªå‘½åèŠ‚ç‚¹';
                const network = params.get('type') || 'tcp';
                const security = params.get('security') || 'none';
                
                return {
                    type: 'VLESS',
                    name: name,
                    address: address,
                    port: parseInt(port),
                    network: network,
                    tls: security
                };
            } catch (e) {
                console.error('VLESS è§£æé”™è¯¯:', e);
                return null;
            }
        }
        
        function parseTrojanInfo(link) {
            try {
                let urlStr = link.replace('trojan://', '');
                
                const atIndex = urlStr.indexOf('@');
                if (atIndex === -1) return null;
                
                const password = urlStr.substring(0, atIndex);
                const remaining = urlStr.substring(atIndex + 1);
                
                const questionIndex = remaining.indexOf('?');
                const hashIndex = remaining.indexOf('#');
                
                let addressPart, namePart;
                
                if (questionIndex !== -1) {
                    addressPart = remaining.substring(0, questionIndex);
                    if (hashIndex !== -1) {
                        namePart = remaining.substring(hashIndex + 1);
                    } else {
                        namePart = '';
                    }
                } else if (hashIndex !== -1) {
                    addressPart = remaining.substring(0, hashIndex);
                    namePart = remaining.substring(hashIndex + 1);
                } else {
                    addressPart = remaining;
                    namePart = '';
                }
                
                const colonIndex = addressPart.lastIndexOf(':');
                const address = colonIndex !== -1 ? addressPart.substring(0, colonIndex) : addressPart;
                const port = colonIndex !== -1 ? addressPart.substring(colonIndex + 1) : '443';
                
                const name = namePart ? decodeURIComponent(namePart) : 'æœªå‘½åèŠ‚ç‚¹';
                
                return {
                    type: 'Trojan',
                    name: name,
                    address: address,
                    port: parseInt(port),
                    network: 'tcp',
                    tls: 'tls'
                };
            } catch (e) {
                console.error('Trojan è§£æé”™è¯¯:', e);
                return null;
            }
        }
        
        function parseShadowsocksInfo(link) {
            try {
                let urlStr = link.replace('ss://', '');
                
                const hashIndex = urlStr.indexOf('#');
                let name = '';
                
                if (hashIndex !== -1) {
                    name = decodeURIComponent(urlStr.substring(hashIndex + 1));
                    urlStr = urlStr.substring(0, hashIndex);
                }
                
                const atIndex = urlStr.indexOf('@');
                let address, port, method;
                
                if (atIndex !== -1) {
                    const encoded = urlStr.substring(0, atIndex);
                    const decoded = atob(encoded);
                    const colonIndex = decoded.indexOf(':');
                    method = decoded.substring(0, colonIndex);
                    
                    const serverPart = urlStr.substring(atIndex + 1);
                    const portIndex = serverPart.lastIndexOf(':');
                    address = serverPart.substring(0, portIndex);
                    port = serverPart.substring(portIndex + 1);
                } else {
                    const decoded = atob(urlStr);
                    const parts = decoded.split('@');
                    const methodPass = parts[0].split(':');
                    method = methodPass[0];
                    
                    const serverPart = parts[1];
                    const portIndex = serverPart.lastIndexOf(':');
                    address = serverPart.substring(0, portIndex);
                    port = serverPart.substring(portIndex + 1);
                }
                
                return {
                    type: 'Shadowsocks',
                    name: name || 'æœªå‘½åèŠ‚ç‚¹',
                    address: address,
                    port: parseInt(port),
                    network: 'tcp',
                    tls: method
                };
            } catch (e) {
                console.error('Shadowsocks è§£æé”™è¯¯:', e);
                return null;
            }
        }
        
        function updateStats(stats) {
            document.getElementById('totalNodes').textContent = parsedNodes.length;
            document.getElementById('vmessCount').textContent = stats.vmess;
            document.getElementById('vlessCount').textContent = stats.vless;
            document.getElementById('trojanCount').textContent = stats.trojan;
            document.getElementById('ssCount').textContent = stats.ss;
        }
        
        function displayNodes() {
            const nodeList = document.getElementById('nodeList');
            const section = document.getElementById('nodeListSection');
            
            nodeList.innerHTML = parsedNodes.map((node, index) => `
                <div class="node-item">
                    <div class="node-name">${index + 1}. [${node.type}] ${node.name}</div>
                    <div class="node-details">${node.address}:${node.port} | ${node.network} + ${node.tls}</div>
                </div>
            `).join('');
            
            section.classList.remove('hidden');
        }
        
        function generateSubscription() {
            if (nodeLinks.length === 0) {
                alert('æ²¡æœ‰å¯ç”¨çš„èŠ‚ç‚¹ï¼');
                return;
            }
            
            const subscriptionContent = nodeLinks.join('\n');
            const base64Subscription = btoa(subscriptionContent);
            
            const output = document.getElementById('output');
            const section = document.getElementById('outputSection');
            
            output.textContent = base64Subscription;
            section.classList.remove('hidden');
            section.scrollIntoView({ behavior: 'smooth' });
        }
        
        function copySubscription() {
            const output = document.getElementById('output');
            navigator.clipboard.writeText(output.textContent).then(() => {
                alert('è®¢é˜…é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
        
        function downloadSubscription() {
            const output = document.getElementById('output');
            const blob = new Blob([output.textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'subscription.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function clearAll() {
            document.getElementById('nodeInput').value = '';
            document.getElementById('nodeListSection').classList.add('hidden');
            document.getElementById('outputSection').classList.add('hidden');
            parsedNodes = [];
            nodeLinks = [];
        }
    </script>
</body>
</html>